import { Theme, Spacing, Typography } from "../tokens.slint";

// Primary button with optional icon
export component PrimaryButton inherits Rectangle {
    in property <string> text;
    in property <image> icon;
    in property <bool> has-icon: false;

    callback clicked();

    // Accessibility (for screen readers)
    accessible-role: button;
    accessible-label: text;
    accessible-action-default => { root.clicked(); }

    // Enable keyboard focus via Tab
    forward-focus: focus-scope;

    height: Spacing.button-height;
    border-radius: Spacing.border-radius-lg;

    // Dynamic background based on interaction state
    background: touch.pressed ? Theme.button-primary-pressed
              : touch.has-hover ? Theme.button-primary-hover
              : Theme.button-primary;
    animate background { duration: 150ms; }

    // Focus ring (visible when focused via keyboard)
    border-width: focus-scope.has-focus ? 2px : 0px;
    border-color: Theme.text-primary;
    animate border-width { duration: 150ms; }

    // Shadow effect
    drop-shadow-blur: 15px;
    drop-shadow-offset-y: 10px;
    drop-shadow-color: #312c8533;  // rgba(49,44,133,0.2)

    // Keyboard focus handler
    focus-scope := FocusScope {
        key-pressed(event) => {
            if (event.text == Key.Return || event.text == " ") {
                root.clicked();
                accept
            }
            reject
        }
    }

    // Use absolute positioning for pixel-perfect alignment
    // Icon
    if has-icon: Image {
        x: Spacing.lg;
        y: (root.height - Spacing.icon-size-sm) / 2;
        width: Spacing.icon-size-sm;
        height: Spacing.icon-size-sm;
        source: icon;
        colorize: white;
        image-fit: contain;
    }

    // Text - offset by 1px down to compensate for font baseline
    Text {
        x: has-icon ? Spacing.lg + Spacing.icon-size-sm + Spacing.sm : (root.width - self.width) / 2;
        y: (root.height - self.height) / 2 + 1px;
        text: root.text;
        color: white;
        font-size: Typography.size-base;
        font-weight: Typography.weight-medium;
    }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}

// Secondary button (outlined/ghost style)
export component SecondaryButton inherits Rectangle {
    in property <string> text;
    in property <image> icon;
    in property <bool> has-icon: false;

    callback clicked();

    // Accessibility (for screen readers)
    accessible-role: button;
    accessible-label: text;
    accessible-action-default => { root.clicked(); }

    // Enable keyboard focus via Tab
    forward-focus: focus-scope;

    min-height: 42px;
    border-radius: Spacing.border-radius-lg;

    // Border changes on focus
    border-width: focus-scope.has-focus ? 2px : 1px;
    border-color: focus-scope.has-focus ? Theme.primary : Theme.input-border;
    animate border-width { duration: 150ms; }
    animate border-color { duration: 150ms; }

    // Dynamic background based on interaction state
    background: touch.pressed ? Theme.input-border
              : touch.has-hover ? Theme.nav-active-background
              : Theme.input-background;
    animate background { duration: 150ms; }

    // Keyboard focus handler
    focus-scope := FocusScope {
        key-pressed(event) => {
            if (event.text == Key.Return || event.text == " ") {
                root.clicked();
                accept
            }
            reject
        }
    }

    HorizontalLayout {
        padding-left: Spacing.md;
        padding-right: Spacing.md;
        spacing: Spacing.sm;
        alignment: center;

        if has-icon: Rectangle {
            width: Spacing.icon-size-sm;
            height: Spacing.icon-size-sm;

            Image {
                width: 100%;
                height: 100%;
                source: icon;
                colorize: Theme.text-muted;
            }
        }

        Text {
            text: root.text;
            color: Theme.text-muted;
            font-size: Typography.size-base;
            font-weight: Typography.weight-medium;
            vertical-alignment: center;
        }
    }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}

// Icon-only button (circular)
export component IconButton inherits Rectangle {
    in property <image> icon;
    in property <color> icon-color: Theme.text-muted;
    in property <length> size: 32px;
    in property <string> accessible-text: "";  // Required for screen readers

    callback clicked();

    // Accessibility (for screen readers)
    accessible-role: button;
    accessible-label: accessible-text;
    accessible-action-default => { root.clicked(); }

    // Enable keyboard focus via Tab
    forward-focus: focus-scope;

    width: size;
    height: size;
    border-radius: size / 2;

    // Dynamic background based on interaction state
    background: touch.pressed ? Theme.input-border
              : touch.has-hover ? Theme.nav-active-background
              : Theme.avatar-background;
    animate background { duration: 150ms; }

    // Focus ring
    border-width: focus-scope.has-focus ? 2px : 0px;
    border-color: Theme.primary;
    animate border-width { duration: 150ms; }

    // Keyboard focus handler
    focus-scope := FocusScope {
        key-pressed(event) => {
            if (event.text == Key.Return || event.text == " ") {
                root.clicked();
                accept
            }
            reject
        }
    }

    Image {
        width: parent.width * 0.5;
        height: parent.height * 0.5;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
        source: icon;
        colorize: icon-color;
    }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}
